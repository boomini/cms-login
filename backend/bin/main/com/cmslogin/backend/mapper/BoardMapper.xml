<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cmslogin.backend.mapper.BoardMapper">

<resultMap type="USER" id="USER">
    <result column="UID" property="uid"/>
    <result column="NAME" property="name"/>
    <result column="PROVIDER" property="provider"/>
</resultMap>
 <resultMap type="BOARD" id="BOARD">
    <result column="board_id" property="board_id"/>
    <result column="NAME" property="name"/>
    <result column="create_at" property="create_at"/>
    <result column="modified_at" property="modified_at"/>
</resultMap>
<resultMap type="POST" id="POST">
    <result column="create_at" property="create_at"/>
    <result column="modified_at" property="modified_at"/>
    <result column="postId" property="postId"/>
    <result column="author" property="author"/>
    <result column="title" property="title"/>
    <result column="content" property="content"/>
    <collection property="board" resultMap="BOARD"/>
    <collection property="user" resultMap="USER"/>
</resultMap>

  <select id="selectBoardByName" resultType="BOARD">
    SELECT *
        FROM Board
      WHERE name = #{name}
  </select>

  <select id="selectPostByBoard" resultMap="POST">
    SELECT *
        FROM post AS p LEFT OUTER JOIN board AS b ON p.board_id = b.board_id
        WHERE b.board_id = #{board_id}
  </select>

  <select id="findById" resultMap="POST">
    SELECT *
        FROM post AS p LEFT OUTER JOIN USER AS u ON p.uid = u.uid
        WHERE p.post_id = #{post_id}
  </select>

  <insert id = "save" useGeneratedKeys="true" keyProperty="post_id">
    INSERT INTO POST (UID,board_id,title,author,content)
    VALUES ( #{user.uid},#{board.board_id}, #{title}, #{author}, #{content})
  </insert>

  <delete id = "delete">
    DELETE FROM post
      WHERE post_id = #{post_id}
  </delete>
</mapper>